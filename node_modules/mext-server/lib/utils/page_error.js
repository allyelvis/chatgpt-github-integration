'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

const mext_utils_1 = require('mext-utils');

const mext_render_1 = require('mext-render');

async function PageError(errorInfo, ctx, react_render) {
  // 页面语法错误,定位到错误页面
  const { status = 500, url = null } = errorInfo;
  ctx.status = status;

  if (url != null) {
    // 抛出重定向
    console.info('[redirect]', url);
    ctx.status = status === 301 ? status : 302;
    ctx.redirect(ctx.mext.config.basename + url);
    return '';
  } else {
    // 抛出错误
    ctx.mext.initialState.MextException = await mext_utils_1.Exception.handleError.call(
      {
        req: ctx.request
      },
      { ...errorInfo, routerError: ctx.mext.routerError }
    );
    return mext_render_1.render(ctx, react_render);
  }
}

exports.default = PageError;
