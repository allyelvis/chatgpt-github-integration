'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

const React = require('react');

const react_router_dom_1 = require('react-router-dom');

const mext_utils_1 = require('mext-utils');

exports.default = ctx => {
  let RootComponent = () => null;
  /**
   * mode区分 server 服务端渲染、前后端分离应用
   *         client 客户端渲染、单页面应用
   */

  const { mode } = ctx.mext.config;

  if (mode === 'server') {
    if (ctx.mext.error && !ctx.mext.routerError) {
      // 发生错误，且是路由外的错误
      const Component = mext_utils_1.Exception.shot();

      RootComponent = () =>
        React.createElement(
          Component,
          Object.assign({}, ctx.mext.initialState.MextException || {})
        );
    } else {
      // 存在路由，渲染正常组件
      const Component = react_router_dom_1.withRouter(ctx.mext.RootComponent);

      RootComponent = () =>
        React.createElement(Component, Object.assign({}, ctx.mext.initialState.mext || {}));
    }
  }

  return RootComponent;
};
